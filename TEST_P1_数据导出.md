# P1 数据导出功能 - 测试指南

## ✅ 功能已完成

**实现日期**：2025-10-23  
**状态**：核心功能完成，测试通过

---

## 🧪 快速测试步骤

### 测试1：导出为Excel

1. 启动应用程序：`python app_full.py`
2. 导入或创建一个数据节点
3. 在项目树中右键点击数据节点
4. 选择"导出数据..."
5. 选择 **Excel (.xlsx)** 格式
6. 勾选"包含元数据"
7. 点击"导出"
8. 检查 `exports/` 文件夹，确认生成了 `.xlsx` 文件
9. 用Excel打开文件，验证：
   - ✅ Data工作表包含完整数据
   - ✅ Metadata工作表包含属性信息
   - ✅ 中文显示正常

---

### 测试2：导出为CSV

1. 右键点击另一个数据节点
2. 选择"导出数据..."
3. 选择 **CSV (.csv)** 格式
4. 点击"导出"
5. 检查 `exports/` 文件夹，确认生成了 `.csv` 文件
6. 用记事本或Excel打开文件，验证：
   - ✅ 数据格式正确（逗号分隔）
   - ✅ 中文显示正常（UTF-8编码）

---

### 测试3：导出为JSON

1. 右键点击数据节点
2. 选择"导出数据..."
3. 选择 **JSON (.json)** 格式
4. 点击"导出"
5. 检查 `exports/` 文件夹，确认生成了 `.json` 文件
6. 用文本编辑器打开文件，验证：
   - ✅ JSON格式正确（可以被解析）
   - ✅ 包含 `name`, `dataframe`, `attributes`, `export_info` 字段
   - ✅ 格式美化（有缩进）

---

### 测试4：文件覆盖确认

1. 重复导出同一个数据（保持相同文件名）
2. 验证：
   - ✅ 弹出确认对话框："文件已存在，是否覆盖？"
   - ✅ 点击"否"，取消导出
   - ✅ 点击"是"，成功覆盖

---

### 测试5：自定义路径

1. 右键点击数据节点
2. 选择"导出数据..."
3. 点击"浏览..."按钮
4. 选择桌面或其他文件夹
5. 输入自定义文件名
6. 点击"导出"
7. 验证：
   - ✅ 文件保存到指定位置
   - ✅ 文件名符合预期

---

### 测试6：错误处理

#### 6.1 空数据导出
1. 创建一个空数据节点
2. 尝试导出为Excel/CSV
3. 验证：
   - ✅ 弹出错误提示："数据为空，无法导出"
   - ✅ 导出JSON仍然成功（包含元数据）

#### 6.2 文件被占用
1. 导出一个文件（如 `test.xlsx`）
2. 用Excel打开该文件（保持打开状态）
3. 再次导出到相同文件名
4. 验证：
   - ✅ 弹出错误提示："文件被占用或无权限写入"
   - ✅ 提示关闭文件后重试

---

## 📊 自动化测试（已通过）

如果想运行自动化测试脚本（开发用）：

```powershell
# 运行测试
D:\SPR\pythonProject4\.venv\Scripts\python.exe test_export.py

# 预期输出
============================================================
数据导出功能测试
============================================================

========== 测试导出Excel ==========
✅ Excel导出成功: D:\SPR\pythonProject4\exports\test_excel.xlsx
   文件大小: 5668 bytes

========== 测试导出CSV ==========
✅ CSV导出成功: D:\SPR\pythonProject4\exports\test_csv.csv
   文件大小: 73 bytes

========== 测试导出JSON ==========
✅ JSON导出成功: D:\SPR\pythonProject4\exports\test_json.json
   文件大小: 801 bytes

总计: 3/3 通过

🎉 所有测试通过！
```

---

## 📁 测试数据

测试时可以使用以下数据：

1. **单样本数据**：导入JSON文件（如 `多循环igg_20240918163627L.json`）
2. **宽表数据**：导入多浓度Excel文件
3. **拟合结果**：对数据进行拟合后生成的fitted_curve数据

---

## ✅ 验收清单

### 核心功能
- [ ] 可以导出Excel格式（.xlsx）
- [ ] 可以导出CSV格式（.csv）
- [ ] 可以导出JSON格式（.json）
- [ ] Excel包含元数据工作表
- [ ] CSV使用UTF-8编码，Excel可正确打开
- [ ] JSON格式美化且完整

### 用户体验
- [ ] 右键菜单"导出数据..."可见
- [ ] 对话框界面友好，选项清晰
- [ ] 默认文件名自动生成（带时间戳）
- [ ] 文件覆盖前有确认提示
- [ ] 成功后显示提示信息
- [ ] 失败时显示错误详情

### 边界情况
- [ ] 空数据处理正确
- [ ] 文件被占用时提示正确
- [ ] 特殊字符文件名自动清理
- [ ] 无权限时提示正确

---

## 📝 测试报告模板

测试完成后，请填写以下表格：

| 测试项 | 结果 | 备注 |
|--------|------|------|
| Excel导出 | ✅/❌ |  |
| CSV导出 | ✅/❌ |  |
| JSON导出 | ✅/❌ |  |
| 文件覆盖确认 | ✅/❌ |  |
| 自定义路径 | ✅/❌ |  |
| 空数据处理 | ✅/❌ |  |
| 文件被占用 | ✅/❌ |  |

---

## 🐛 已知问题

暂无

---

## 📞 反馈

如果测试中发现问题，请记录：
1. 操作步骤
2. 预期结果
3. 实际结果
4. 错误信息（截图或文字）
5. 数据类型（单样本/宽表/拟合结果）

---

*祝测试顺利！ 🚀*

