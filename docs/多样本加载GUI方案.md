# å¤šæ ·æœ¬åŠ è½½GUIå®ç°æ–¹æ¡ˆ

## âœ… å·²å®ç°ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰

### 1. è‡ªåŠ¨æ£€æµ‹å¤šæ ·æœ¬å¹¶æ„å»ºå®½è¡¨

**ä»£ç ä½ç½®**ï¼š`src/models/data_model.py` ç¬¬140-153è¡Œ

**åŠŸèƒ½**ï¼š
- è‡ªåŠ¨æ£€æµ‹JSONä¸­çš„æ ·æœ¬æ•°é‡
- å¦‚æœ`len(samples) > 1`ï¼šè‡ªåŠ¨æ„å»ºå®½è¡¨
- å¦‚æœ`len(samples) == 1`ï¼šä¿æŒåŸæœ‰é€»è¾‘

**ç¤ºä¾‹è¾“å‡º**ï¼š
```
âœ… ä»JSONåŠ è½½å¤šæµ“åº¦æ•°æ®: 8ä¸ªæ ·æœ¬ â†’ å®½è¡¨ (å¤šå¾ªç¯igg (8æµ“åº¦))
âœ… æ„å»ºå®½è¡¨: 15æ—¶é—´ç‚¹ Ã— 8æµ“åº¦
   åˆ—å: ['Time', '0.0', '1.0167e-09', '2.0833e-09', '4.1667e-09', 
          '8.3333e-09', '1.6667e-08', '3.3333e-08', '6.6667e-08']
```

### 2. `_build_wide_table_from_samples`æ–¹æ³•

**ä»£ç ä½ç½®**ï¼š`src/models/data_model.py` ç¬¬167-224è¡Œ

**åŠŸèƒ½**ï¼š
- æå–æ‰€æœ‰æ ·æœ¬çš„Timeå’ŒYValue
- ä½¿ç”¨Concentrationä½œä¸ºåˆ—å
- è‡ªåŠ¨æ£€æŸ¥æ•°æ®ç‚¹å¯¹é½
- è¿”å›æ ‡å‡†å®½è¡¨DataFrame

**æ•°æ®æ ¼å¼**ï¼š
```
Time | 0.0      | 1.02e-09 | 2.08e-09 | ... | 6.67e-08
0.0  | -0.43    | -0.46    | ...      | ... | ...
1.0  | -0.62    | -0.70    | ...      | ... | ...
2.0  | -0.32    | -0.37    | ...      | ... | ...
...
```

### 3. ä¿®å¤fitting_wrapperçš„æ ¼å¼æ£€æŸ¥

**ä»£ç ä½ç½®**ï¼š`src/utils/fitting_wrapper.py` ç¬¬114-138è¡Œ

**ä¿®æ”¹**ï¼š
- ç§»é™¤äº†é”™è¯¯çš„"å•æ ·æœ¬è½¬å®½è¡¨"é€»è¾‘ï¼ˆæµ“åº¦=0çš„bugï¼‰
- ç®€åŒ–ä¸ºåªæ£€æŸ¥å®½è¡¨æ ¼å¼
- æ¸…æ™°çš„é”™è¯¯æç¤º

---

## ğŸ¨ GUIæ˜¾ç¤ºæ–¹æ¡ˆ

### æ–¹æ¡ˆAï¼šæ•°æ®åˆ—è¡¨æ˜¾ç¤ºï¼ˆå½“å‰å»ºè®®ï¼‰ âœ…

**æ•ˆæœ**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ•°æ®ç®¡ç†                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ“Š] å¤šå¾ªç¯igg (8æµ“åº¦)                  â”‚ â† å•ä¸ªæ¡ç›®
â”‚      15ä¸ªæ—¶é—´ç‚¹                         â”‚
â”‚      æµ“åº¦èŒƒå›´: 0 ~ 6.67e-08 M           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜ç‚¹**ï¼š
- ç”¨æˆ·ä½“éªŒç®€å•
- ä¸€æ¬¡åŠ è½½ï¼Œä¸€æ¬¡æ‹Ÿåˆ
- ç¬¦åˆç§‘ç ”ä¹ æƒ¯

**éœ€è¦ä¿®æ”¹çš„GUIç»„ä»¶**ï¼š
1. **æ•°æ®åˆ—è¡¨** (`project_tree.py` æˆ–ç±»ä¼¼)ï¼š
   - æ˜¾ç¤ºæ•°æ®åç§°æ—¶ï¼Œå¦‚æœåç§°åŒ…å«"(Nconc)"ï¼Œä½¿ç”¨ä¸åŒçš„å›¾æ ‡
   - åœ¨tooltipä¸­æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼ˆæµ“åº¦åˆ—è¡¨ã€æ—¶é—´ç‚¹æ•°ç­‰ï¼‰

2. **æ•°æ®é¢„è§ˆ** (æ–°å¢æˆ–å¢å¼ºç°æœ‰)ï¼š
   - ç‚¹å‡»æ•°æ®æ—¶ï¼Œæ˜¾ç¤ºå®½è¡¨çš„é¢„è§ˆ
   - å¯é€‰ï¼šç»˜åˆ¶æ‰€æœ‰æµ“åº¦æ›²çº¿ï¼ˆå¤šæ¡çº¿ï¼Œä¸åŒé¢œè‰²ï¼‰

### æ–¹æ¡ˆBï¼šæ ‘çŠ¶å±•å¼€æ˜¾ç¤ºï¼ˆå¯é€‰ï¼‰

**æ•ˆæœ**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [+] å¤šå¾ªç¯igg (8æµ“åº¦)                   â”‚ â† å¯å±•å¼€
â”‚ â”‚   â”œâ”€ 0.0 M                            â”‚
â”‚ â”‚   â”œâ”€ 1.02e-09 M                       â”‚
â”‚ â”‚   â”œâ”€ 2.08e-09 M                       â”‚
â”‚ â”‚   â””â”€ ...                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¼˜ç‚¹**ï¼š
- å¯ä»¥æŸ¥çœ‹å„æµ“åº¦æ˜ç»†
- å¯é€‰æ‹©æ€§åŠ è½½éƒ¨åˆ†æµ“åº¦

**ç¼ºç‚¹**ï¼š
- å®ç°å¤æ‚
- å¯¹äºæ ‡å‡†SPRå®éªŒï¼Œå‡ ä¹ä¸éœ€è¦

---

## ğŸ”„ æ‹Ÿåˆæµç¨‹ï¼ˆå·²ä¿®å¤ï¼‰

### å½“å‰æµç¨‹ï¼š

```
1. ç”¨æˆ·é€‰æ‹©æ•°æ® â†’ ç‚¹å‡»"æ‹Ÿåˆ"
   â†“
2. Controller.on_fit_data
   - è·å–Dataå¯¹è±¡
   - æ£€æŸ¥dataframeæ˜¯å¦æ˜¯å®½è¡¨æ ¼å¼ âœ…
   â†“
3. FittingWrapper._fit_local_bivariate
   - DataFrameæ ¼å¼æ£€æŸ¥ï¼ˆTime + æµ“åº¦åˆ—ï¼‰ âœ…
   - ä¿å­˜ä¸ºä¸´æ—¶Excel
   â†“
4. LocalBivariate.model_runner
   - è¯»å–Excel â†’ å®½è¡¨ (n_time Ã— n_concentration)
   - åŒæ—¶æ‹Ÿåˆæ‰€æœ‰æµ“åº¦æ›²çº¿ âœ…
   - è¿”å› (T_data, Y_data, Y_pred)ï¼Œéƒ½æ˜¯ (n_time Ã— n_concentration) çš„äºŒç»´æ•°ç»„
   â†“
5. è¿”å›Controller
   - Y_pred.flatten() â†’ ä¸€ç»´æ•°ç»„
   - åˆ›å»ºæ‹Ÿåˆæ›²çº¿Dataå¯¹è±¡
```

### å…³é”®ä¿®å¤ï¼š

âœ… **ä¿®å¤1**ï¼šè‡ªåŠ¨æ„å»ºå®½è¡¨ï¼ˆæµ“åº¦>0ï¼‰  
âœ… **ä¿®å¤2**ï¼šç§»é™¤é”™è¯¯çš„å•æ ·æœ¬è½¬æ¢é€»è¾‘  
âœ… **ä¿®å¤3**ï¼šä½¿ç”¨åŸå§‹model_runnerï¼ˆtime_break=133ç¡¬ç¼–ç ï¼‰  

---

## ğŸ“Š ç»˜å›¾å¢å¼ºï¼ˆå»ºè®®ï¼‰

### 1. å¤šæµ“åº¦æ›²çº¿é¢„è§ˆ

åœ¨æ•°æ®åŠ è½½åï¼Œè‡ªåŠ¨ç»˜åˆ¶æ‰€æœ‰æµ“åº¦çš„åŸå§‹æ›²çº¿ï¼š

```python
# figure_model.py æˆ– canvas_widget.py
def plot_multiconcentration_data(self, data: Data):
    """ç»˜åˆ¶å¤šæµ“åº¦æ•°æ®çš„æ‰€æœ‰æ›²çº¿"""
    df = data.dataframe
    cols = df.columns
    
    if len(cols) >= 2:
        time_col = cols[0]
        conc_cols = cols[1:]
        
        for conc in conc_cols:
            self.ax.plot(df[time_col], df[conc], 
                        label=f'{conc} M', alpha=0.7)
        
        self.ax.legend()
        self.ax.set_xlabel('Time (s)')
        self.ax.set_ylabel('Response (RU)')
        self.ax.set_title(data.name)
```

### 2. æ‹Ÿåˆå¯¹æ¯”å›¾

æ‹Ÿåˆå®Œæˆåï¼Œæ˜¾ç¤ºï¼š
- åŸå§‹æ•°æ®ï¼ˆå¤šæ¡å½©è‰²çº¿ï¼‰
- æ‹Ÿåˆæ›²çº¿ï¼ˆå¤šæ¡è™šçº¿ï¼‰
- å‚æ•°æ ‡æ³¨ï¼ˆRmax, kon, koff, KDï¼‰

---

## ğŸ§ª æµ‹è¯•æ¸…å•

### æµ‹è¯•1ï¼šåŠ è½½å¤šæµ“åº¦JSON

```bash
py app_full.py
â†’ æ‰“å¼€æ–‡ä»¶ â†’ é€‰æ‹© "å¤šå¾ªç¯igg_20240918163627L.json"
â†’ æ£€æŸ¥æ•°æ®åˆ—è¡¨æ˜¯å¦æ˜¾ç¤º "å¤šå¾ªç¯igg (8æµ“åº¦)"
â†’ æ£€æŸ¥æ§åˆ¶å°è¾“å‡ºæ˜¯å¦åŒ…å« "âœ… æ„å»ºå®½è¡¨: 15æ—¶é—´ç‚¹ Ã— 8æµ“åº¦"
```

### æµ‹è¯•2ï¼šæ‹Ÿåˆå¤šæµ“åº¦æ•°æ®

```bash
â†’ é€‰ä¸­æ•°æ® â†’ å³é”® â†’ "æ‹Ÿåˆ"
â†’ é€‰æ‹©æ–¹æ³• "LocalBivariate"
â†’ æ£€æŸ¥æ§åˆ¶å°è¾“å‡º:
   [FittingWrapper] âœ… DataFrameæ˜¯å®½è¡¨æ ¼å¼
   æ—¶é—´åˆ—: Time
   æµ“åº¦åˆ—: [0.0, 1.0167e-09, 2.0833e-09, ...]
   Rmax: XX.XXXX
   kon: X.XXXXe+XX
   koff: X.XXXXe+XX
â†’ æ£€æŸ¥æ‹Ÿåˆæ›²çº¿æ˜¯å¦ä¸å†æ˜¯ç›´çº¿/é›¶çº¿
```

### æµ‹è¯•3ï¼šæŸ¥çœ‹æ‹Ÿåˆç»“æœ

```bash
â†’ æ£€æŸ¥ç»“æœåˆ—è¡¨æ˜¯å¦æ˜¾ç¤º "å¤šå¾ªç¯igg (8æµ“åº¦) - LocalBivariate"
â†’ ç‚¹å‡»ç»“æœ â†’ æŸ¥çœ‹å‚æ•°ï¼ˆRmax, kon, koffï¼‰
â†’ æ£€æŸ¥æ‹Ÿåˆæ›²çº¿å›¾
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æµ‹è¯•ï¼ˆé˜¶æ®µ1ï¼‰

1. âœ… è¿è¡Œ `py app_full.py`
2. âœ… åŠ è½½å¤šå¾ªç¯JSON
3. âœ… æ‰§è¡ŒLocalBivariateæ‹Ÿåˆ
4. âœ… éªŒè¯æ‹Ÿåˆç»“æœä¸å†æ˜¯é›¶çº¿/ç›´çº¿

### åŠŸèƒ½å®Œå–„ï¼ˆé˜¶æ®µ2ï¼‰

1. ğŸ”² æ·»åŠ å¤šæµ“åº¦æ›²çº¿é¢„è§ˆ
2. ğŸ”² åœ¨æ•°æ®åˆ—è¡¨æ˜¾ç¤ºæµ“åº¦èŒƒå›´
3. ğŸ”² æ”¹è¿›æ‹Ÿåˆç»“æœå›¾è¡¨ï¼ˆå¤šæ›²çº¿å¯¹æ¯”ï¼‰

### é«˜çº§åŠŸèƒ½ï¼ˆé˜¶æ®µ3ï¼‰

1. ğŸ”² æ ‘çŠ¶å±•å¼€æŸ¥çœ‹å„æµ“åº¦
2. ğŸ”² æ‰¹é‡åŠ è½½å¤šä¸ªJSON
3. ğŸ”² å®éªŒåˆ†ç»„ç®¡ç†

---

## ğŸ“ å…³é”®ä»£ç ç‰‡æ®µ

### æ£€æµ‹å®½è¡¨æ ¼å¼ï¼ˆfitting_wrapper.pyï¼‰

```python
# ç¬¬119-138è¡Œ
if len(df.columns) >= 2:
    first_col = df.columns[0]
    if first_col in ['Time', 'time', 'XValue', 'X']:
        other_cols = df.columns[1:]
        try:
            concentrations = [float(str(col)) for col in other_cols]
            is_valid_format = True
            print(f"[FittingWrapper] âœ… DataFrameæ˜¯å®½è¡¨æ ¼å¼")
            print(f"   æµ“åº¦åˆ—: {concentrations}")
        except:
            is_valid_format = False
```

### æ„å»ºå®½è¡¨ï¼ˆdata_model.pyï¼‰

```python
# ç¬¬167-224è¡Œ
def _build_wide_table_from_samples(self, samples: list):
    time_values = [d.get('XValue') for d in samples[0]['BaseData']]
    wide_data = {'Time': time_values}
    
    for sample in samples:
        concentration = sample['Concentration']
        y_values = [d.get('YValue') for d in sample['BaseData']]
        wide_data[str(concentration)] = y_values
    
    return pd.DataFrame(wide_data)
```

---

## ğŸ‰ é¢„æœŸæ•ˆæœ

ä¿®å¤åï¼Œæ‚¨åº”è¯¥çœ‹åˆ°ï¼š

1. **åŠ è½½æ—¶**ï¼š
   ```
   âœ… ä»JSONåŠ è½½å¤šæµ“åº¦æ•°æ®: 8ä¸ªæ ·æœ¬ â†’ å®½è¡¨ (å¤šå¾ªç¯igg (8æµ“åº¦))
   âœ… æ„å»ºå®½è¡¨: 15æ—¶é—´ç‚¹ Ã— 8æµ“åº¦
   ```

2. **æ‹Ÿåˆæ—¶**ï¼š
   ```
   [FittingWrapper] âœ… DataFrameæ˜¯å®½è¡¨æ ¼å¼
   Rmax: 45.2340
   kon: 1.2345e+05
   koff: 2.3456e-03
   KD: 1.9012e-08
   ```

3. **æ‹Ÿåˆæ›²çº¿**ï¼šä¸å†æ˜¯é›¶çº¿/ç›´çº¿ï¼Œè€Œæ˜¯ç¬¦åˆSPRåŠ¨åŠ›å­¦çš„å¤šæ¡æ›²çº¿ï¼

